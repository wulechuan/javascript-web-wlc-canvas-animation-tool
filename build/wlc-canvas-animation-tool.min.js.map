{"version":3,"sources":["wlc-canvas-animation-tool.js"],"names":["createWhatWeWant","window","wlcCanvasAnimationController","canvas","a","b","_init","initOptions","regExpCanvasContextType","thisInstance","drawFrame","match","canvasContextType","trim","toLowerCase","canvasContext","getContext","config","call","animationShouldStop","b_startAnimation","getData","elements","data","state","animationIsStopped","animationShouldPause","animationIsPaused","animationStartWallTime","timeOffsetInSeconds","localPlayingDurationInSeconds","localTimeInSeconds","drawnFramesCount","drawingFramesCountLimitation","_definePublicState","publicState","Object","defineProperty","pN_animationIsStopped","enumerable","get","set","console","warn","pN_animationIsPaused","pN_animationShouldStop","isToStopAnimation","stopAnimation","startAnimation","pN_animationShouldPause","isToPauseAnimation","pauseAnimation","resumeAnimation","pN_shouldClearCanvasBeforeDrawing","shouldClearCanvasBeforeDrawing","shouldClear","pN_drawingFramesCountLimitation","limitation","isNaN","NaN","parseInt","pN_timeOffsetInSeconds","offset","parseFloat","pN_bgColor","bgColor","newColor","pN_isValidColor","options","hasOwnProperty","getCanvas","getCanvasContext","getCanvasContextType","clearCanvasViaMethod","b_clearCanvas","b_stopAnimation","_clearCanvas","clearRect","width","height","shouldClearCanvas","newTimeOffset","Date","getTime","b_drawNextFrame","_drawNextFrame","info","log","b_pauseAnimation","b_drawOneFrame","requestAnimationFrame","drawOneFrame","_drawOneFrameOnTime","drawOneFrameOnTimeViaMethod","_drawOrClearBg","fillStyle","fillRect","this","settings","canvasDefaultBgColor","canvasDefaultContextType","error","Node","document","getElementById","pN_isJQueryWrappedObjectOrAlike","tagName","DOMPropertyNameForThisTypeOfInstance","appendChild","createElement","writable","value","bind","b_resumeAnimation","drawOneFrameOnTime","clearCanvas","object","__proto__","jquery","color"],"mappings":"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","file":"wlc-canvas-animation-tool.min.js","sourcesContent":["(function (createWhatWeWant) {\n\twindow.wlcCanvasAnimationController = createWhatWeWant();\n})(function createWhatWeWant() {\n\n\t// To define some long property names this way helps js better minified.\n\t// Because we are using local variables as keys to access properties,\n\t// and local variables can be minified,\n\t// while strings and direct property keys can not be minified.\n\tvar DOMPropertyNameForThisTypeOfInstance = 'wlcCanvasAnimationControllerInstance';\n\tvar pN_isJQueryWrappedObjectOrAlike = 'isJQueryWrappedObjectOrAlike';\n\tvar pN_isJQueryWrappedObject = 'isJQueryWrappedObject';\n\tvar pN_isValidColor = 'isValidColor';\n\n\tvar pN_shouldClearCanvasBeforeDrawing = 'shouldClearCanvasBeforeDrawing';\n\n\tvar pN_animationShouldStop = 'animationShouldStop';\n\tvar pN_animationIsStopped = 'animationIsStopped';\n\tvar pN_animationShouldPause = 'animationShouldPause';\n\tvar pN_animationIsPaused = 'animationIsPaused';\n\n\tvar pN_drawingFramesCountLimitation = 'drawingFramesCountLimitation';\n\tvar pN_timeOffsetInSeconds = 'timeOffsetInSeconds';\n\n\tvar pN_bgColor = 'bgColor';\n\n\n\t/**\n\t * Constructor for create an instant object that helps making canvas animations.\n\t * \n\t * @constructor\n\t * @author 吴乐川 <wulechuan@live.com>\n\t * @argument {!(string|Node|jQueryObject)} canvas the canvas element,\n\t * \tor the container object that is NOT a canvas element,\n\t *  under which a new canvas element will be created automatically.\n\t * \n\t * @argument {?(string|function|object)} a Multi-purpose.\n\t * \t\tIf 1 argument is provided:\n\t * \t\t>\tIf it's a string, it's treated as the canvas context type;\n\t * \t\t\tIf it's an object, it's treated as the \"options\" objet;\n\t * \t\t\tIf it's a function, it's treated as the \"drawFrame\" method.\n\t * \n\t * \t\tIf 2 arguments are provided:\n\t * \t\t>\tThe one that is a string is treated as the canvas context type;\n\t * \t\t\tThe one that is an object is treated as the \"options\" objet;\n\t * \t\t\tThe one that is a function is treated as the \"drawFrame\" method;\n\t * \n\t * \t\t\tTf both are of the same type, e. g. both are functions,\n\t * \t\t\tan error will be logged and construction will fail.\n\t * \n\t * \t\t\tIf a function is provided, while the other argument being an object,\n\t * \t\t\tand contains a function property named \"drawFrame\",\n\t * \t\t\tthen the property of the object argument is taken,\n\t * \t\t\tthe function argument is ignored.\n\t * \n\t * @argument {?(string|function|object)} b Multi-purpose.\n\t * >\tSee argument a.\n\t * \n\t * \n\t * @example\n\t * \tvar myCanvas = document.querySelector('#my-canvas');\n\t *  var myAniCtrl = new wlcCanvasAnimationController(\n\t * \t\tmyCanvas,\n\t * \t\tfunction myFancyDrawingFunction () { ... }\n\t *  );\n\t * \n\t * @example\n\t * \tvar myCanvas = document.querySelector('#my-canvas');\n\t *  var myAniCtrl = new wlcCanvasAnimationController(\n\t * \t\tmyCanvas,\n\t * \t\t{\n\t * \t\t\tdrawFrame: function myFancyDrawingFunction() { ... }\n\t * \t\t}\n\t *  );\n\t * \n\t * @example\n\t * \tvar myCanvas = document.querySelector('#my-canvas');\n\t *  var myAniCtrl = new wlcCanvasAnimationController(\n\t * \t\tmyCanvas,\n\t * \t\t'3d',\n\t * \t\t{\n\t * \t\t\tdrawFrame: function myFancyDrawingFunction() { ... }\n\t * \t\t}\n\t *  );\n\t */\n\n\tfunction wlcCanvasAnimationController(canvas, a, b) {\n\t\tvar thisInstance = this;\n\n\t\tvar settings = {\n\t\t\tcanvasDefaultBgColor: '',\n\t\t\tcanvasDefaultContextType: '2d'\n\t\t};\n\n\n\n\n\n\n\n\n\t\t// private variables\n\t\tvar canvasContext = null;\n\t\tvar canvasContextType = settings.canvasDefaultContextType;\n\n\t\tvar shouldClearCanvasBeforeDrawing = true;\n\t\tvar bgColor = settings.canvasDefaultBgColor;\n\n\t\tvar animationShouldStop = false;\n\t\tvar animationIsStopped = true;\n\t\tvar animationShouldPause = false;\n\t\tvar animationIsPaused = false;\n\n\t\tvar animationStartWallTime = NaN;\n\t\tvar timeOffsetInSeconds = 0;\n\t\tvar localPlayingDurationInSeconds = 0;\n\t\tvar localTimeInSeconds = 0;\n\n\t\tvar drawnFramesCount = 0;\n\t\tvar drawingFramesCountLimitation = NaN; // In case we need to draw like 1000 frames and then stop there for ever\n\n\n\n\n\n\n\t\tif ((typeof a === 'object' && typeof b === 'object' && a && b)\n\t\t\t|| (typeof a === 'string' && typeof b === 'string')\n\t\t\t|| (typeof a === 'function' && typeof b === 'function')\n\t\t) {\n\t\t\tconsole && console.error('Invalid arguments.');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(canvas instanceof Node)) {\n\t\t\tif (typeof canvas === 'string') {\n\t\t\t\tcanvas = document.getElementById(canvas);\n\t\t\t} else if (wlcCanvasAnimationController[pN_isJQueryWrappedObjectOrAlike](canvas)) {\n\t\t\t\tcanvas = canvas[0];\n\t\t\t} else {\n\t\t\t\tcanvas = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!canvas) {\n\t\t\tconsole && console.error('Invalid canvas provided.');\n\t\t\treturn;\n\t\t}\n\n\t\tif (canvas.tagName.match(/canvas/i)) {\n\t\t\tif (canvas[DOMPropertyNameForThisTypeOfInstance]) {\n\t\t\t\treturn canvas[DOMPropertyNameForThisTypeOfInstance];\n\t\t\t}\n\t\t} else {\n\t\t\tcanvas = canvas.appendChild(document.createElement('canvas'));\n\t\t}\n\n\n\n\n\n\n\t\tObject.defineProperty(canvas, DOMPropertyNameForThisTypeOfInstance, {\n\t\t\tenumerable: true,\n\t\t\twritable: false,\n\t\t\tvalue: thisInstance\n\t\t});\n\n\n\n\n\n\n\t\tvar requestAnimationFrame = window.requestAnimationFrame;\n\n\n\t\t// Being public means being writable.\n\t\tvar publicState = _definePublicState.call(thisInstance);\n\t\tthisInstance.state = publicState;\n\n\n\t\t// Define \"this\"-bound methods for conveniences and better source code minification.\n\t\tvar b_drawNextFrame = _drawNextFrame.bind(thisInstance);\n\t\tvar b_stopAnimation = stopAnimation.bind(thisInstance);\n\t\tvar b_startAnimation = startAnimation.bind(thisInstance);\n\t\tvar b_pauseAnimation = pauseAnimation.bind(thisInstance);\n\t\tvar b_resumeAnimation = resumeAnimation.bind(thisInstance);\n\t\tvar b_clearCanvas = _clearCanvas.bind(thisInstance);\n\t\tvar b_drawOneFrame = drawOneFrame.bind(thisInstance);\n\n\n\t\tthisInstance.config = config.bind(thisInstance);\n\t\tthisInstance.getData = getData.bind(thisInstance);\n\t\tthisInstance.getCanvas = getCanvas.bind(thisInstance);\n\t\tthisInstance.getCanvasContext = getCanvasContext.bind(thisInstance);\n\t\tthisInstance.getCanvasContextType = getCanvasContextType.bind(thisInstance);\n\n\t\tthisInstance.stopAnimation = b_stopAnimation;\n\t\tthisInstance.startAnimation = b_startAnimation;\n\t\tthisInstance.pauseAnimation = b_pauseAnimation;\n\t\tthisInstance.resumeAnimation = b_resumeAnimation;\n\n\t\tthisInstance.drawOneFrame = b_drawOneFrame;\n\t\tthisInstance.drawOneFrameOnTime = drawOneFrameOnTimeViaMethod.bind(thisInstance);\n\t\tthisInstance.clearCanvas = clearCanvasViaMethod.bind(thisInstance);\n\n\n\n\t\t_init.call(thisInstance, a, b);\n\n\n\n\n\n\n\n\t\tfunction _init(a, b) {\n\t\t\tvar regExpCanvasContextType = /\\s*(2d|3d|webgl)\\s*/i;\n\t\t\tvar initOptions;\n\n\t\t\tif (typeof a === 'object' && a) {\n\t\t\t\tinitOptions = a;\n\n\t\t\t\tif (typeof b === 'function') {\n\t\t\t\t\tthisInstance.drawFrame = b;\n\t\t\t\t} else if (typeof b === 'string' && b.match(regExpCanvasContextType)) {\n\t\t\t\t\tcanvasContextType = b.trim().toLowerCase();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof b === 'object' && b) {\n\t\t\t\tinitOptions = b;\n\n\t\t\t\tif (typeof a === 'function') {\n\t\t\t\t\tthisInstance.drawFrame = a;\n\t\t\t\t} else if (typeof a === 'string' && a.match(regExpCanvasContextType)) {\n\t\t\t\t\tcanvasContextType = a.trim().toLowerCase();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcanvasContext = canvas.getContext(canvasContextType);\n\n\t\t\tconfig.call(thisInstance, initOptions);\n\n\n\t\t\tif (!animationShouldStop) {\n\t\t\t\t// if animationShouldPause,\n\t\t\t\t// then we still need to first start the animation.\n\t\t\t\t// Because to pause a stopped animation doesn't make any sence.\n\t\t\t\treturn b_startAnimation();\n\t\t\t}\n\t\t}\n\n\n\n\t\t/**\n\t\t * Get a copy of all private data just for inspection\n\t\t * @return {object}\n\t\t */\n\t\tfunction getData() {\n\t\t\treturn {\n\t\t\t\telements: {\n\t\t\t\t\tcanvas: canvas\n\t\t\t\t},\n\t\t\t\tdata: {\n\t\t\t\t\tcanvasContext: canvasContext,\n\t\t\t\t\tcanvasContextType: canvasContextType\n\t\t\t\t},\n\t\t\t\tstate: {\n\t\t\t\t\tanimationShouldStop: animationShouldStop,\n\t\t\t\t\tanimationIsStopped: animationIsStopped,\n\t\t\t\t\tanimationShouldPause: animationShouldPause,\n\t\t\t\t\tanimationIsPaused: animationIsPaused,\n\t\t\t\t\tanimationStartWallTime: animationStartWallTime,\n\t\t\t\t\ttimeOffsetInSeconds: timeOffsetInSeconds,\n\t\t\t\t\tlocalPlayingDurationInSeconds: localPlayingDurationInSeconds,\n\t\t\t\t\tlocalTimeInSeconds: localTimeInSeconds,\n\t\t\t\t\tdrawnFramesCount: drawnFramesCount,\n\t\t\t\t\tdrawingFramesCountLimitation: drawingFramesCountLimitation\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Define some properties using getters and setters,\n\t\t * So that they can be accessed directly in public.\n\t\t * @return {object}\n\t\t */\n\t\tfunction _definePublicState() {\n\t\t\tvar publicState = {};\n\n\t\t\tObject.defineProperty(publicState, pN_animationIsStopped, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn animationIsStopped;\n\t\t\t\t},\n\t\t\t\tset: function () {\n\t\t\t\t\tconsole.warn('state.'+pN_animationIsStopped+' is a read-only property.');\n\t\t\t\t\treturn animationIsStopped;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_animationIsPaused, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn animationIsPaused;\n\t\t\t\t},\n\t\t\t\tset: function () {\n\t\t\t\t\tconsole.warn('state.'+pN_animationIsPaused+' is a read-only property.');\n\t\t\t\t\treturn animationIsPaused;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_animationShouldStop, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn animationShouldStop;\n\t\t\t\t},\n\t\t\t\tset: function (isToStopAnimation) {\n\t\t\t\t\tif (isToStopAnimation) {\n\t\t\t\t\t\tstopAnimation.call(thisInstance);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartAnimation.call(thisInstance);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn animationShouldStop;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_animationShouldPause, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn animationShouldPause;\n\t\t\t\t},\n\t\t\t\tset: function (isToPauseAnimation) {\n\t\t\t\t\tif (isToPauseAnimation) {\n\t\t\t\t\t\tpauseAnimation.call(thisInstance);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresumeAnimation.call(thisInstance);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn animationShouldPause;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_shouldClearCanvasBeforeDrawing, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn shouldClearCanvasBeforeDrawing;\n\t\t\t\t},\n\t\t\t\tset: function (shouldClear) {\n\t\t\t\t\tshouldClearCanvasBeforeDrawing = !!shouldClear;\n\t\t\t\t\treturn shouldClearCanvasBeforeDrawing;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_drawingFramesCountLimitation, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn drawingFramesCountLimitation;\n\t\t\t\t},\n\t\t\t\tset: function (limitation) {\n\t\t\t\t\tif (isNaN(limitation)) {\n\t\t\t\t\t\tdrawingFramesCountLimitation = NaN;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlimitation = parseInt(limitation);\n\t\t\t\t\t\tif (!isNaN(limitation)) {\n\t\t\t\t\t\t\tdrawingFramesCountLimitation = limitation;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn drawingFramesCountLimitation;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_timeOffsetInSeconds, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn timeOffsetInSeconds;\n\t\t\t\t},\n\t\t\t\tset: function (offset) {\n\t\t\t\t\toffset = parseFloat(offset);\n\t\t\t\t\tif (!isNaN(offset)) {\n\t\t\t\t\t\ttimeOffsetInSeconds = offset;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn timeOffsetInSeconds;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tObject.defineProperty(publicState, pN_bgColor, {\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function () {\n\t\t\t\t\treturn bgColor;\n\t\t\t\t},\n\t\t\t\tset: function (newColor) {\n\t\t\t\t\tif (wlcCanvasAnimationController[pN_isValidColor](newColor)) {\n\t\t\t\t\t\tbgColor = newColor.trim().toLowerCase();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn bgColor;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn publicState;\n\t\t}\n\n\t\tfunction config(options) {\n\t\t\toptions = options || {};\n\t\t\tvar _inputTemp;\n\n\n\t\t\t// Just use defined setters to update public values,\n\t\t\t// so that we don't need to write type/value validation codes again here.\n\t\t\tif (options.hasOwnProperty(pN_animationShouldStop)) {\n\t\t\t\tpublicState[pN_animationShouldStop] = options[pN_animationShouldStop];\n\t\t\t}\n\n\t\t\tif (options.hasOwnProperty(pN_animationShouldPause)) {\n\t\t\t\tpublicState[pN_animationShouldPause] = options[pN_animationShouldPause];\n\t\t\t}\n\n\t\t\tif (options.hasOwnProperty(pN_shouldClearCanvasBeforeDrawing)) {\n\t\t\t\tpublicState[pN_shouldClearCanvasBeforeDrawing] = options[pN_shouldClearCanvasBeforeDrawing];\n\t\t\t}\n\n\t\t\tif (options.hasOwnProperty(pN_drawingFramesCountLimitation)) {\n\t\t\t\tpublicState[pN_drawingFramesCountLimitation] = options[pN_drawingFramesCountLimitation];\n\t\t\t}\n\n\t\t\tif (options.hasOwnProperty(pN_timeOffsetInSeconds)) {\n\t\t\t\tpublicState[pN_timeOffsetInSeconds] = options[pN_timeOffsetInSeconds];\n\t\t\t}\n\n\t\t\tif (options.hasOwnProperty(pN_bgColor)) {\n\t\t\t\tpublicState[pN_bgColor] = options[pN_bgColor];\n\t\t\t}\n\n\n\t\t\t_inputTemp = options.drawFrame;\n\t\t\tif (typeof _inputTemp === 'function') {\n\t\t\t\tthisInstance.drawFrame = options.drawFrame;\n\t\t\t}\n\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction getCanvas() {\n\t\t\treturn canvas;\n\t\t}\n\n\t\tfunction getCanvasContext() {\n\t\t\treturn canvasContext;\n\t\t}\n\n\t\tfunction getCanvasContextType() {\n\t\t\treturn canvasContextType;\n\t\t}\n\n\t\tfunction clearCanvasViaMethod() {\n\t\t\tb_clearCanvas();\n\t\t\treturn b_stopAnimation(); // for chaining method invocations\n\t\t}\n\n\t\tfunction _clearCanvas() {\n\t\t\tcanvasContext.clearRect(0, 0, canvas.width, canvas.height);\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction stopAnimation(shouldClearCanvas) {\n\t\t\tanimationIsStopped = true;\n\t\t\tanimationIsPaused = false;\n\n\t\t\tanimationShouldPause = false;\n\t\t\tanimationShouldStop = false;\n\n\t\t\tif (shouldClearCanvas) b_clearCanvas();\n\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction startAnimation(newTimeOffset) {\n\t\t\tif (!animationIsPaused && !animationIsStopped) {\n\t\t\t\treturn thisInstance;\n\t\t\t}\n\n\t\t\tanimationIsStopped = false;\n\t\t\tanimationIsPaused = false;\n\n\t\t\tdrawnFramesCount = 0;\n\t\t\tlocalPlayingDurationInSeconds = 0;\n\n\t\t\t// Set twice, if the second value (which is the argument) is invalid and not taken\n\t\t\t// Then the first value (which is zero) takes effects.\n\t\t\tpublicState[pN_timeOffsetInSeconds] = 0;\n\t\t\tpublicState[pN_timeOffsetInSeconds] = newTimeOffset;\n\n\t\t\tanimationStartWallTime = new Date().getTime() - timeOffsetInSeconds;\n\n\t\t\tb_drawNextFrame();\n\n\t\t\t// animationShouldStop = false;\n\t\t\t// animationShouldPause = false;\n\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction pauseAnimation() {\n\t\t\tif (animationIsStopped || animationIsPaused) return;\n\t\t\tanimationIsPaused = true;\n\t\t\tanimationShouldPause = false;\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction resumeAnimation() {\n\t\t\tif (animationIsStopped || !animationIsPaused) return;\n\n\t\t\tanimationIsPaused = false;\n\t\t\tb_drawNextFrame();\n\n\t\t\treturn thisInstance; // for chaining method invocations\n\t\t}\n\n\t\tfunction _drawNextFrame(/* DOMHighResTimeStamp */) {\n\t\t\t// The \"DOMHighResTimeStamp\" provided by the browser\n\t\t\t// is more accurate but unfortunately NOT what I want.\n\n\t\t\tif (animationIsPaused || animationIsStopped) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (animationShouldStop) {\n\t\t\t\tb_stopAnimation();\n\t\t\t}\n\n\t\t\tif (typeof thisInstance.drawFrame !== 'function') {\n\t\t\t\tconsole.info(\n\t\t\t\t\t'The \"drawFrame\" method is not provided yet.',\n\t\t\t\t\t'Animation will not start.'\n\t\t\t\t);\n\t\t\t\tb_stopAnimation();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdrawnFramesCount++;\n\t\t\tif (drawnFramesCount > drawingFramesCountLimitation) {\n\t\t\t\tconsole.log('Animation frame limitation met. Animation will stop now.');\n\t\t\t\tb_stopAnimation();\n\t\t\t\treturn;\n\t\t\t}\n\n\n\n\t\t\tlocalPlayingDurationInSeconds = (new Date() - animationStartWallTime) / 1000;\n\t\t\tlocalTimeInSeconds = localPlayingDurationInSeconds + timeOffsetInSeconds;\n\n\n\n\n\t\t\tif (animationShouldPause) {\n\t\t\t\tb_pauseAnimation();\n\t\t\t}\n\n\t\t\tb_drawOneFrame();\n\n\t\t\trequestAnimationFrame(b_drawNextFrame);\n\t\t}\n\n\t\tfunction drawOneFrame() {\n\t\t\treturn _drawOneFrameOnTime.call(thisInstance, localTimeInSeconds);\n\t\t}\n\n\t\tfunction drawOneFrameOnTimeViaMethod(localTimeInSeconds) {\n\t\t\t_drawOneFrameOnTime.call(thisInstance, localTimeInSeconds);\n\t\t\treturn pauseAnimation.call(thisInstance); // for chaining method invocations\n\t\t}\n\n\t\tfunction _drawOneFrameOnTime(localTimeInSeconds) {\n\t\t\t_drawOrClearBg.call(thisInstance, localTimeInSeconds)\n\t\t\t\t.drawFrame(canvas, canvasContext, localTimeInSeconds);\n\t\t\treturn thisInstance;\n\t\t}\n\n\t\tfunction _drawOrClearBg() {\n\t\t\tif (shouldClearCanvasBeforeDrawing) {\n\t\t\t\tb_clearCanvas();\n\t\t\t}\n\n\t\t\tcanvasContext.fillStyle = bgColor;\n\t\t\tcanvasContext.fillRect(0, 0, canvas.width, canvas.height);\n\n\t\t\treturn thisInstance;\n\t\t}\n\t}\n\n\twlcCanvasAnimationController[pN_isJQueryWrappedObjectOrAlike] = function (object) {\n\t\treturn wlcCanvasAnimationController[pN_isJQueryWrappedObject](object)\n\t\t\t|| object[0] instanceof Node;\n\t};\n\n\twlcCanvasAnimationController[pN_isJQueryWrappedObject] = function (object) {\n\t\treturn !!object.__proto__.jquery;\n\t};\n\n\twlcCanvasAnimationController[pN_isValidColor] = function (color) {\n\t\treturn typeof color === 'string' || !!color;\n\t};\n\n\treturn wlcCanvasAnimationController;\n});\n"]}